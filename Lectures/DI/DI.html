<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
          integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
          crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
          integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
          crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
          integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
          crossorigin="anonymous"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9QJ5D3X353"></script>
  <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
          dataLayer.push(arguments);
      }

      gtag('js', new Date());
      gtag('config', 'G-9QJ5D3X353');
  </script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;1,400&display=swap"
        rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="../../globalStyles.css">
  <meta name="author" content="Raj Gaurav Ballabh Kumar">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DI</title>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">

  <div class="navbar-header">
    <a href="../../index.html" class="navbar-brand"> rgbk21</a>
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"><span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="nav navbar-nav">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="../../Projects/TwitterCritNodes/TwitterCritNodes_1.html">Identifying Critical Nodes on Twitter</a>
          <a class="dropdown-item" href="../../Projects/isRelatedTo/isRelatedTo.html">isRelatedTo</a>
          <div class="dropdown-divider"></div>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">HTML Projects</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="../../WordleCheater/index.html">Wordle Cheater</a>
          <a class="dropdown-item" href="../../Pig_Game/index.html">2-Player Pig Game</a>
          <a class="dropdown-item" href="../../ImageGallery/ImageGallery.html">Image Gallery</a>
          <a class="dropdown-item" href="../../RGB_Guesser_Game/RGB.html">RGB Guesser Game</a>
          <a class="dropdown-item" href="../../ToDoList/todo.html">To-Do List</a>
          <div class="dropdown-divider"></div>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Notes</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="../../Lectures/COMS_631/COMS_631_index.html">COMS 631</a>
          <a class="dropdown-item" href="../../Lectures/COMS_535/COMS_535_index.html">COMS 535</a>
          <a class="dropdown-item" href="../../Lectures/EffectiveJava/EffectiveJava.html">Effective Java</a>
          <a class="dropdown-item" href="../../Lectures/DI/DI.html">Dependency Injection</a>
          <div class="dropdown-divider"></div>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Code</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="../../Code/ThingsToRemember/ThingsToRemember.html">Things To Remember</a>
          <a class="dropdown-item" href="../../Code/Java_Notes/JavaNotes.html">Java Notes</a>
          <a class="dropdown-item" href="../../Code/Java_Notes/JavaNotes_2.html">Java Notes 2</a>
          <a class="dropdown-item" href="../../Code/LeetCode/LeetCode.html">LeetCode Notes</a>
          <a class="dropdown-item" href="../../Code/Applying_Java_Notes/ApplyingJava_Notes.html">ApplyingJava Notes</a>
          <a class="dropdown-item" href="../../Code/JavaScript/JavaScript.html">JavaScript Notes</a>
          <a class="dropdown-item" href="../../Code/HTML_CSS/HTML_CSS_Basics.html">HTML & CSS Notes</a>
          <a class="dropdown-item" href="../../Code/SQL/SQL.html">SQL Notes</a>
          <a class="dropdown-item" href="../../Code/Spring/Spring.html">Spring Notes</a>
          <a class="dropdown-item" href="../../Code/Kafka/Kafka.html">Kafka Notes</a>
          <a class="dropdown-item" href="../../Code/Angular/Angular.html">Angular</a>
          <a class="dropdown-item" href="../../Code/Hibernate/Hibernate.html">Hibernate</a>
          <div class="dropdown-divider"></div>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">In Another Life</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="../../InAnotherLife/Chapter1/Chapter1.html">Chapter 1</a>
          <a class="dropdown-item" href="../../InAnotherLife/Chapter2/Chapter2.html">Chapter 2</a>
          <a class="dropdown-item" href="../../InAnotherLife/Chapter3/Chapter3.html">Chapter 3</a>
          <div class="dropdown-divider"></div>
        </div>
      </li>
    </ul>


    <ul class="navbar-nav ml-auto">
      <li class="nav-item active"><a class="nav-link" href="https://github.com/rgbk21">GitHub</a></li>
      <li class="nav-item active"><a class="nav-link" href="https://www.linkedin.com/in/raj-gaurav-ballabh-kumar-97002058/">LinkedIn</a></li>
      <li class="nav-item active"><a class="nav-link" href="https://www.instagram.com/wobblyframes/">Instagram</a></li>
      <li class="nav-item active"><a class="nav-link" href="https://www.facebook.com/SomeRandomThoughts">Facebook</a></li>
    </ul>
  </div>
</nav>

<div class="container">

  <button id='load-all-gists' type="button" class="btn btn-outline-primary">Show all Gists!</button>

  <div>
    This page contains my notes from the following books: <br>
    a) Dependency Injection in Action by Prasanna <br>
    b) Learning Google Guice by Hussain Pithawala <br>
  </div>


  <br>
  Index for Book Dependency Injection in Action by Prasanna: <br>
  Chapter 0 - <a href="#InterestingLinks">Interesting Links</a> <br>
  Chapter 1 - <a href="#Prasanna_Chapter1">Dependency injection: what's all the hype</a> <br>
  Chapter 2 - <a href="#Prasanna_Chapter2">Time for Injection</a> <br>
  Chapter 3 - <a href="#Prasanna_Chapter3">Investigating DI</a> <br>
  Chapter 4 - <a href="#Prasanna_Chapter4">Building Modular Applications</a> <br>
  Chapter 5 - <a href="#Prasanna_Chapter5">Scope - A Fresh Breath of State</a> <br>
  Chapter 6 - <a href="#Prasanna_Chapter6">More use cases in scoping</a>

  <br>
  <br>

  Index for Book Learning Google Guice by Hussain Pithawala: <br>
  Chapter 4 - <a href="#Pithawala_Chapter4">Guice in Web Development</a> <br>
  <br>

  <hr>
  <div id="InterestingLinks" class="chapter">Interesting Links</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">Links</div>
    <div>
      - <a href="https://github.com/google/guice/wiki/">Google Guice Wiki on Github</a> <br>
      - <a href="https://github.com/google/guice/wiki/FrequentlyAskedQuestions">FAQs on Guice</a> <br>
      - <a href="https://groups.google.com/g/google-guice">Google Guice Group</a> <br>
      - <a href="https://google.github.io/guice/api-docs/latest/javadoc/com/google/inject/assistedinject/FactoryModuleBuilder.html">Link to java doc for</a>
      <code>FactoryModuleBuilder</code> <br>
      - In Guice, the default scope is Prototype. In Spring, the default scope of a Bean is Singleton. <br>
      - <a href="https://stackoverflow.com/questions/39688830/why-use-develop-guice-when-you-have-spring-and-dagger">Guice, Dagger, Spring</a> <br>
      - <a href="https://docs.spring.io/spring-framework/docs/3.0.0.M3/reference/html/ch04s04.html">Bean scopes in Spring. Official Doc.</a> <br>
    </div>
  </div>

  <hr>
  <div id="Prasanna_Chapter1" class="chapter">Chapter 1: Dependency injection - what's all the hype?</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">Seeing objects as services</div>
    <div>
      - A central idea in this book is that - <i>of an object acting as a service</i>. Take an email sending service for example. The email itself can be viewed as a message
      composition service, the internet relays that are routing the email to its destination as delivery agents, and the receiver's inbox as a receiving service. <br>
      - Consider the following architecture for the service:
      <img src="imgs/ch1/EmailMessagingService.PNG"
           class="center-block img-fluid"
           alt="EmailMessagingService"
           width="700">
      - Let the three objects responsible for these actions be: <code>Emailer</code>, <code>InternetRelay</code>, <code>RecipientInbox</code>. Each object is a <i>client</i>
      of the next. <code>Emailer</code> uses the <code>InternetRelay</code> as a service to send email, and in turn, the <code>InternetRelay</code> uses the
      <code>RecipientInbox</code>
      as a service to deliver sent mail. <br>
      - There's value in decomposing our services into objects. Take the <code>Emailer</code> for example. The <code>Emailer</code> will require a text editor to type-in the
      email. This logic could be added in the <code>Emailer</code> class itself, but it is better to create a new <code>TextEditor</code>. Pulling this functionality into its
      own class has the following advantages: <br>
      a) Our <code>Emailer</code> is not cluttered with distracting code meant for text manipulation. <br>
      b) We can reuse the <code>TextEditor</code> component in other scenarios (say, a calendar or note-taking application) without much additional coding. <br>
      c) If someone else has written a general-purpose text-editing component, we can make use of it rather than writing one from scratch <br>
      - This principle is important because it highlights the relationship between one object and other objects it uses to perform its function: an object depends on its
      services in order to perform its function. In this example that we are talking about, the <code>Emailer</code> class depends upon a <code>TextEditor</code>,
      <code>SpellChecker</code>, and a <code>Dictionary</code> to perform its functions. Hence these 3 classes are the <i>dependencies</i> of the <code>Emailer</code> class.
      In other words, the <code>Emailer</code> class is a <i>client</i> of its <i>dependencies</i>. <br>
      - The dependencies of the <code>Emailer</code> class may have dependencies of their own and this relationship carries on transitively. This composite system of
      dependencies is known as the <i>object graph</i>. <br>
      - Hence we get the following definitions: <br>
      a) <p class="inline-heading">Service</p>: An object that performs a <i>well-defined</i> function when it is called. <br>
      b) <p class="inline-heading">Client</p>: Any consumer of a service. A client calls a service to perform a <i>well-understood</i> function. <br>
      c) <p class="inline-heading">Dependency</p>: A specific service that is <i>required</i> by another object to fulfill its function. <br>
      d) <p class="inline-heading">Dependent</p>: A client object that needs a dependency (or dependencies) in order to perform its function. <br>
      e) <p class="inline-heading">Dependency Injection</p>: DI is the study of reliably and efficiently building such object graphs and the strategies, patterns, and best
      practices therein. <br>
    </div>

    <div class="sub-heading">Pre DI Solutions</div>
    <div>
      - Suppose you were asked to create an <code>Emailer</code> which is composed of a <code>SpellChecker</code>, this might be the first thing that you come up with:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/b8be3cd32369ab39bd09f6e334f47985.js"></script>
        </div>
      </div>
      - But what is the problem with this approach? Suppose you wanted to test that the <code>SpellChecker</code> was in-fact being called when you used the <i>send</i>
      method to send an email. One way to do this would be to create a <code>MockSpellChecker</code>and make <code>Emailer</code> use that:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/14034bdca00106464dad5a0c52d1434d.js"></script>
        </div>
      </div>
      - But now you cannot use this mock because you cannot substitute the internal spellchecker that the <code>Emailer</code> class has. This effectively makes the
      <code>Emailer</code> class untestable. <br>
      - There is another problem with this approach. You cannot create objects of the same <code>Emailer</code> class with different functionality. For instance, suppose you
      were writing an email client for the english language, then you would do something like:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/45b4380ab5c6575fcfca05017208a99b.js"></script>
        </div>
      </div>
      - Now if you wanted to use the same <code>Emailer</code> class for the french language, you would have to create a completely new <code>Emailer</code> class. We need
      another system where instead of the dependent creating its own dependencies, it has them provided externally. <br>
    </div>

    <div class="sub-heading">Construction by hand</div>
    <div>
      - Instead of the constructor of the <code>Emailer</code> creating its own <code>SpellChecker</code>, we can add a method that <i>accepts</i> a <code>SpellChecker</code>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/eebbd96e096960d8ef94a39aef5b12d4.js"></script>
        </div>
      </div>
      - This allows us to substitute the <code>SpellChecker</code> with a version of our own, and thus we can use the <code>MockSpellChecker</code> that we created above to
      now test the functionality of the <code>Emailer</code> class. Similarly, we can also substitute the <code>SpellChecker</code> with another spell checker easily now.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/5433736deef30f1c06ea70be32b53f5a.js"></script>
        </div>
      </div>
      - In the above example, we are setting the <code>SpellChecker</code> manually. At the time of construction of the <code>Emailer</code> class, we are manually setting the
      dependency. Hence, this is also sometimes referred to as <i>construction by hand</i>. <br>
      - The above code was an example of <i>setter injection</i>. You can also do a <i>constructor injection</i> by passing in the dependency during the construction of the
      <code>Emailer</code> class itself. The advantage of following this approach is that it makes the dependency between the two classes explicit. You cannot create an
      <code>Emailer</code> class without creating a <code>SpellChecker</code> class. And thus it reduces the chances of someone forgetting to set the dependency on the object.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/61dd10e33ac604bb15728f8590b1e356.js"></script>
        </div>
      </div>

      <p class="inline-heading">Problems with construction-by-hand</p>:
      The problem with this technique is that the burden of knowing how to create the object graph is placed on the client of the service. In this case, it is the
      <code>Emailer</code> class that must set up its dependency, <code>SpellChecker</code>, either through constructor or through setter injection. Also, if the same object is
      being
      used in multiple places, then you need to repeat the code of wiring together the object in all the places. If you decide to change the dependency graph in the future, you
      will have to go to all the places and make the change yourself. <br>
      - Another problem is the fact that users need to know how object graphs are wired internally. This violates the principle of encapsulation and becomes problematic when
      dealing with code that is used by many clients, who really shouldn't have to care about the internals of their dependencies in order to use them.
    </div>


    <div class="sub-heading">Factory Pattern</div>
    <div>
      - One way of getting around the problem of having to construct the objects in an object graph yourself is to use a Factory Pattern.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/6d175592d5dcb92296c26debe810c19c.js"></script>
        </div>
      </div>
      - The most important thing to notice here is that the client code has no reference to spellchecking, address books, or any of the other internals of <code>Emailer</code>.
      By adding a level of abstraction (the Factory pattern), we have separated the code using the <code>Emailer</code> from the code that creates the <code>Emailer</code>. This
      leaves client code clean and concise. This becomes even more useful when the object graph of the created object is even more complex.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/0e2ee1d113d17abdf6b279edd180fc17.js"></script>
        </div>
      </div>
      - Talking about testing, the <code>Emailer</code> code is still using the same constructor injection it was using previously. So we can still test the <code>Emailer</code>
      class as we were previously. <br>

      <p class="inline-heading">Problems with using Factory Pattern</p>:
      Testing the internals of the object returned from the factory becomes difficult unless the factory has explicitly provided capabilities to test it. What do I mean by that?
      This client does not know anything about <code>Emailer</code>'s internals; instead, it depends on a Factory. In one of the previous scenarios, we were able to swap out the
      <code>SpellChecker</code> being injected into the class with a <code>MockSpellChecker</code> of our own. But that will not be possible in this case. <br>
      - Another issue is that if you are going with Factory Pattern then you will have to create a new method for <i>every</i> variation of <i>every</i> service. That is a lot of
      code to test and maintain. If you decided that you wanted to replace the <code>AddressBook</code> with <code>PhoneAndAddressBook</code>, you will have to go through all the
      methods in the factory and make the substitution. Plus there might be many dependencies that are common across different types of <i>Emailer</i> objects but which you still
      have to specify separately for each new method that you add to the factory. One way to get around this is to use a 'general' factory that first creates a common version of
      the object and then use that intermediate object to set any specific fields on it. But this again leads to code that is difficult to test.
    </div>


    <div class="sub-heading">Service Locator Pattern</div>
    <div>
      - A Service Locator is also a kind of factory. The way that it works is that you pass in a <i>key</i> to the service locator, and the service locator replies with a
      fully-formed object that you can use in your code. <br>
      - This is what it would look like: <code>Emailer emailer = (Emailer) new ServiceLocator().get("Emailer");</code> <br>
      - Since all the locator needs is a key, a Service Locator acts as a factory that can return <i>any</i> kind of service. Compare this to the <i>EmailerFactory</i> class where
      it was returning only one type of object - namely <i>Emailer</i>. <br>
      - The Java Naming and Directory Interface (JNDI) is a good example of a Service Locator pattern. It is often used by application servers to register resources at start time
      and later by deployed applications to look them up. Web applications typically use JNDI to look up data sources in this manner. <br>
      - An example of gettig a different object: <code>Emailer emailer = (Emailer) new ServiceLocator().get("JapaneseEmailerWithPhoneAndEmail");</code>

      <p class="inline-heading">Problems with using Service Locator Pattern</p>:
      Being a kind of Factory, Service Locators suffer from the same problems of testability and shared state. The keys used to identify a service are opaque and
      can be confusing to work with. The practice of embedding information about the service within its identifier (namely, "JapaneseEmailerWithPhoneAndEmail") is also verbose and
      places too much emphasis on arbitrary conventions.
    </div>


    <div class="sub-heading">Embracing Dependency Injection</div>
    <div>
      - DI is a magical way that takes all the good parts of the above solutions and leaves behind all the bad parts. DI enables testability in the same way as construction
      by hand, via a setter method or constructor injection. DI removes the need for clients to know about their dependencies and how to create them, just as factories do. It
      leaves behind the problems of shared state and repetitive clutter, by moving construction responsibility to a library. <br>
      - In case of DI, the task of creating, assembling, and wiring the dependencies into an object graph is performed by an external framework known as a <i>dependency
      injection framework</i> or simply a <i>dependency injector</i>. The control over the construction, wiring, and assembly of an object graph no loger resides with the clients
      or services themselves. This is also known as the <i>Inversion of Control</i>.

      <img src="imgs/ch1/DI_Basics.png"
           class="center-block img-fluid"
           alt="EmailMessagingService"
           width="700">
    </div>

    - Notice that <i>EmailClient</i> knows nothing about what kind of <i>Emailer</i> it needs or is using to send a message. All it knows is that it accepts <i>some kind</i> of
    <i>Emailer</i>, and this dependency is used when needed. Also notice that the client code is now starting to resemble service code; both are free of logic to create or locate
    dependencies. <br>
    - This highlights the separation of <i>infrastructure</i> code (meant for wiring and construction) from <i>application</i> code (the core purpose of a service).

    <div class="code-block">
      <div class="expand-code-snip-btn border border-primary rounded">
        <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
      </div>
      <div class="code-snippet">
        <script src="https://gist.github.com/rgbk21/ec25eeab502bc56ce05816aff7b0cc21.js"></script>
      </div>
    </div>

    - Footnote about Gin: Guice is also available inside the Google Web Toolkit (GWT), via its cousin Gin. Google Gin is a port of Guice for the GWT, a JavaScript web framework.
    Find out more <a href=" http://code.google.com/p/google-gin">here</a>.
  </div>

  <hr>
  <div id="Prasanna_Chapter2" class="chapter">Chapter 2: Time for Injection</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">Constructing objects with dependency injection</div>
    <div>
      - The dependency injector is itself a service like any other. And like any service, it must be constructed and prepared before it can be used. Once the injector has been
      bootstrapped, we can obtain an object from it for use. <br>
      - This is an example of using Guice for injection:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/e86b74b88b00f833425b131e3f78a3a0.js"></script>
        </div>
      </div>
      - Think of Guice as a factory class for Dependency Injectors. Note that in the above example, you are asking Guice directly for an <i>Emailer</i> class. The object graph of
      the <i>Emailer</i> class requires dependencies <i>SpellChecker</i> and <i>Dict</i>. But you don't have to worry about providing these. Guice can wire-up the fully-formed
      object for you when you request it. Also note that you had to use the <code>@Inject</code> annotation on the <i>Emailer</i> and the <i>SpellChecker</i> classes in order to
      get the code to compile properly. If you remove this annotation, from either of the classes, you get the following error: "Could not find a suitable constructor in
      Chapter2._1_Basics.SpellChecker. Classes must have either one (and only one) constructor annotated with @Inject or a zero-argument constructor that is not private." <br>
      - The <code>@Inject</code> annotation is supposed to tell Guice which constructor to use when creating the object, and consequently what it's dependencies are. <br>
      - In this particular line: <code>Emailer emailer = Guice.createInjector().getInstance(Emailer.class);</code> you are doing something similar to what we did in the Service
      Locator pattern, the difference being now we are using a class type to get an object as the key, instead of directly using a string. In a sense the injector is an automated,
      all-purpose service locator prepackaged for convenience.
    </div>

    <div class="sub-heading">Metadata and injector configuration</div>
    <div>
      - In essence what you did by using the <code>@Inject</code> annotation was configure the <i>injector</i> by telling it which constructor to use and hence what the
      dependencies of the object are. If you had been using Spring, you would do the same thing by using <code>@Component</code> and <code>@Autowired</code> combination. <br>
      - There are multiple ways in which you can configure the injector: <br>
      a) Using an XML Configuration File <br>
      b) Invoking into a programmatic API <br>
      c) Using an injection-oriented DSL <br>
      d) By inference; that is, implicitly from the structure of classes <br>
      e) By inference from annotated source code <br>
    </div>

    <div class="sub-heading">XML Injection in Spring</div>
    <div>
      - When using injection in Spring, we do the following (the other stuff remains common):
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/cd4caccc8345e055c4c03d10393d2a5d.js"></script>
        </div>
      </div>
      - Here, <code>BeanFactory</code> refers to the Spring dependency injector. The call to <code>getBean()</code> is analogous to the original call to <code>getInstance()</code>.
      Both return an instance of <i>Emailer</i>. The <code>FileSystemXmlApplicationContext</code> is a special type of <code>BeanFactory</code>. There are other kinds of
      application contexts available for use as well. They are mentioned on <a href="https://www.baeldung.com/spring-application-context">this link on Baeldung</a>. <br>
      - The file email.xml contains the configuration required for Spring's injector to provide us with an emailer correctly wired with its dependencies.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/32d203ce8fc105af20bb09e6c4ef62ef.js"></script>
        </div>
      </div>
    </div>


    <div class="sub-heading">XML to in-code configuration in Guice</div>
    <div>
      - Using an XML configuration is advantageous in the sense that all the configuration can be easily seen in one place which becomes easier when you are working on a large
      project. You can do the same thing with Guice as well. In the case of Guice, you can do it in two ways. Either by implementing the <code>Module</code> interface, or by
      extending the <code>AbstractModule</code> class. <br>
      - Guice is able to automatically inject Concrete Class with either a public no argument constructor or a constructor with @Inject without any specific defined binding in your
      module but when it comes to Interfaces you have to define the necessary bindings. <a href="https://stackoverflow.com/a/24767043/8742428">Source on SO</a>. This is what the
      module class would look like with the bindings defined:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/4a751aa7e972a90f9e16bc5adc4f128b.js"></script>
        </div>
      </div>
      - Note that the config on the main class now changes slightly. Note that we are passing in the module class that we created to the <code>createInjector</code> method. Without
      this it does not work.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c6de64563a10362fd45c653be092c593.js"></script>
        </div>
      </div>
      - If you were doing the same thing using the <code>AbstractModule</code>, this is what the module class would look like. And instead of passing in the
      <code>new EmailModule()</code> as you did above, you would now be passing in <code>new EmailAbstractModule()</code>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/579b34d53bbd72572650f977f1d3ff92.js"></script>
        </div>
      </div>

      - Note that you can also pass in multiple modules as args:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/1861cfa6d03e9327364c17505ba6aee2.js"></script>
        </div>
      </div>


    </div>

    <div class="sub-heading">Revisiting Spring and autowiring</div>
    <div>
      - You can use autowire in the config files to configure the Spring injections as well. The config file in that case will look like this. But note that Intellij does not like
      this and tries to revert to the method above, ie. make the constructor injection explicit.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/f5c015df851d377dad20fca44f12e184.js"></script>
        </div>
      </div>
      - Of course, you can also just entirely ignore the XML configuration, and go directly with annotations. In the setup that you are using, you still included the xml file as
      well.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/2fb23c6b05b2844647cfda9551688488.js"></script>
        </div>
      </div>
      - And the context that we are using to get the beans from is defined as follows:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/fd9c66d9a2c10e213fbd05b70bb5ceb4.js"></script>
        </div>
      </div>
      - Note that now we have to use the <code>ClassPathXmlApplicationContext</code>, instead of the <code>FileSystemXmlApplicationContext</code> that we used previously above.
      Note that you also had to add this in Facets in Intellij, because it was giving you a warning. Note the folder structure as well. The reason for highlighting the folder
      structure is so that you can notice the usage of class path related stuff. See how paths are being used in
      <code>new ClassPathXmlApplicationContext("email-actual-autowire-config.xml")</code> and <code>&lt;context:component-scan base-package="_1_Basics"/&gt;</code> and relate it to
      the folder structure being used. The same warning that you get when you add an XML configuration file, you also get when you annotate a java class with
      <code>@Configuration</code>. Both, XML files and <code>@Configuration</code> are different but equivalent ways of telling Spring how you want to setup the beans.
      <img src="imgs/ch2/SpringFacets.PNG"
           class="center-block img-fluid"
           alt="SpringFacets"
           width="1919">
      - The three application contexts that were introduced above can be seen here:
      <img src="imgs/ch2/ApplicationContexts.PNG"
           class="center-block img-fluid"
           alt="SpringFacets"
           width="1920">
    </div>

    <div class="sub-heading">Identifying dependencies for injection</div>
    <div>
      - A <i>flat object</i> is an object that has no dependencies of its own. <br>
      - In the Guice example that we saw above, there is a single implementation of the <i>EmailerIF</i> that we are using to inject in as a dependency, namely the <i>Emailer</i>
      class. But we might have multiple implemnetations of the same interface and we may want to conditionally inject different implementations depending on our requirements. For
      example, on the right side, we have two implementations of the <i>EmailerIF</i>, <i>Emailer</i> and <i>AdvancedEmailer</i>. So when we create an <i>EmailClient</i>, we might
      might want to choose either of the implementations, <i>Emailer</i> or <i>AdvancedEmailer</i>. So how do you tell your injector which of these two dependencies you want to
      use? This is the question we will be trying to answer here.
      <img src="imgs/ch2/DependencyGraph.png"
           class="center-block img-fluid"
           alt="SpringFacets"
           width="2288">
    </div>

    <div class="sub-heading">Identifying by String keys</div>
    <div>
      - Suppose that we are using Spring, and we are trying to create the following dependency graph. <i>Emailer</i> requires a <i>SpellChecker</i>, and there are two possible
      implementations of it - <i>EnglishSpellChecker</i> and <i>FrenchSpellChecker</i>.
      <img src="imgs/ch2/DependencyGraph-MultipleSpellCheckers.png"
           class="center-block img-fluid"
           alt="SpringFacets"
           width="650">
      - Then depending on the type of <i>Emailer</i> that we are trying to create, we can configure the xml as follows:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/9afb7a7196facbfb28a31e4def5f26f5.js"></script>
        </div>
      </div>
      - And we create instances of the <i>Emailer</i> as follows: and this will give us a fully-formed french emailer.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/56ccc5aab5595ffe13c9be564c054a65.js"></script>
        </div>
      </div>

      <p class="inline-heading">Drawbacks of this method</p>: <br>
      a) A misspelled key that maps to no valid service can be difficult to detect until well into the runtime of the program. If you are working with a statically typed language
      like Java, this is a poor sacrifice to have to make. These languages are supposed to offer guarantees around type validity at compile time. Ideally, one should not have to
      wait until runtime to detect problems in key bindings. Intellij does not warn you about these kinds of errors, and they appear only during runtime. <br>
      b) In your injector configuration there is no way to determine the type of a binding if all you have is a string key. Without starting up the injector and inspecting the
      specific instance for a key, it is hard to determine what type the key is bound to. But do note that Intellij does provide you with some level of static checking in order to
      minimize this kind of issue. For example suppose you passed in an incorrect class <i>Dict_2</i> instead of <i>Dict</i>, Intellij would give you a compile error.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/9b1177e703fd32ab7c59ccb9267dc39a.js"></script>
        </div>
      </div>
    </div>


    <div class="sub-heading">Identifying by type</div>
    <div>
      - Since Guice configuration file requires you to explicitly specify the class that you are going to inject, the compile time checking of the classes being injected can be
      done in Guice configuration as well (just like Spring). This takes care of the point 2 of the drawback we discussed above. Also since there is no name in the form of String
      being associated with the dependency, there is no scope of mistyping the name and getting a run time error either. This takes care of the point 1 of the drawback. <br>
      - All the stuff with the XML configuration that we did in the above section using Spring, we can also do using simple annotations. We make use of the
      <code>@Configuration</code> and <code>@Bean</code> annotations for this. The objective is still the same - pass in different implementations of the <i>SpellChecker</i> class
      for the specific implementations for the <i>Emailer</i>. But this time without using XML. <br>
      - First we need to define a configuration class that would be equivalent to defining the XML file in the previous approach. The <code>@Configuration</code> annotation
      indicates that the class can be used by the Spring IoC container as a source of bean definitions. It indicates that a class declares one or more <code>@Bean</code> methods
      and may be processed by the Spring container to generate bean definitions and service requests for those beans at runtime. <br>
      - The <code>@Bean</code> annotation tells Spring that a method annotated with <code>@Bean</code> will return an object that should be registered as a bean in the Spring
      application context. See <a href="https://www.tutorialspoint.com/spring/spring_java_based_configuration.htm">this link on Tutorials Point for a good explanation</a>.
      We aren't doing anything special, all we have done is convert the XML bindings into code.

      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/25754a5e019d116afd77c350b9dd177c.js"></script>
        </div>
      </div>

      - And then we can use these beans as follows. We need to register and refresh the context for <a
      href="https://stackoverflow.com/questions/28404817/annotationconfigapplicationcontext-has-not-been-refreshed-yet-whats-wrong">this reason explained on SO</a>. <br>
      - If you had just a single object of a particular type, you could have fetched the object using the type of the object, as we are doing with the <i>EnglishSpellChecker</i> in
      the below example. For other cases, you would have to fall back to using the String keys instead.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/15819463dcb790c67fdf08d33efd09f9.js"></script>
        </div>
      </div>

      <p class="inline-heading">Drawbacks of this method</p>: <br>
      a) Like we saw, if we use types, we cannot distinguish between different implementations of the same service.
    </div>


    <div class="sub-heading">Combinatorial Keys</div>
    <div>
      - Ideally we want something like this: <i>[Emailer.class, "english"]</i>. The type key identifies the service that dependents rely on, in a safe and consistent manner. Its
      counterpart, the string key, identifies the specific variant that the key is bound to but does so in an abstract manner. However, the String part of the key is still
      susceptible to typos and errors that we saw previously. We get around this issue by using an annotation in place of a String. <br>
      - Guice<sup>TM</sup> embodies the use of type/annotation combinatorial keys and was probably the first library to use this strategy. <br>
      - Suppose this is the object graph that we are going to create. As we can see in the diagram, <i>FrenchEmailer</i> and <i>EnglishEmailer</i> both require the dependency
      <i>SpellChecker</i>. But there are two different implementations available: <i>FrenchSpellChecker</i> and <i>EnglishSpellChecker</i>. We want the <i>EnglishSpellChecker</i>
      to be injected into the <i>EnglishEmailer</i> class and the <i>FrenchSpellChecker</i> into the <i>FrenchEmailer</i> class. <br>
      - The way we are going to do this is through the use of annotations. At the point where we are injecting <i>SpellChecker</i> type into the <i>EnglishEmailer</i> for eg., we
      will annotate that injection with a custom annotation <code>@English</code> that we have created. Then we are going to tell Guice that - hey, whenever you see a dependency
      that requires the <i>SpellChecker</i> object, and has been annotated with <i>@English</i>, you should inject the <i>EnglishSpellChecker</i> exclusively. In the same manner,
      we are going to do for the french side as well.
      <img src="imgs/ch2/Emailer_Guice_Annotations.png"
           class="center-block img-fluid"
           alt="SpringFacets"
           width="1764">


      Step 1) We create custom annotations that we are going to make use of.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/ec3f8c09cbfcbf1e971dd54d58c1793a.js"></script>
        </div>
      </div>

      Step 2) Annotate the injections with the respective annotations:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c9c8382e8f51029c271ea6b7e548b010.js"></script>
        </div>
      </div>

      Step 3) Tell Guice to inject the dependencies based off of the annotation that we are using:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/63f146607e32c890047a33813184e62f.js"></script>
        </div>
      </div>

      Step 4) Get the object that you are interested in from the injector and makes use as required:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/b6a32fe74f1f6e7917822ccc4e57dec7.js"></script>
        </div>
      </div>

      - This might strike you as odd - while the <i>EnglishEmailer</i> does not depend directly on a specific implementation, it seems to couple via the use of
      <code>@English</code> annotation. Doesn't this mean <i>EnglishEmailer</i> is tightly coupled to English spellcheckers? The answer is a surprising no. To understand why,
      consider the following altered injector configuration: <code>bind(SpellChecker.class).annotatedWith(English.class).to(FrenchSpellChecker.class);</code>. Here, we've changed
      the service implementation bound to the combinatorial key <i>[SpellChecker.class, English.class]</i> so that any dependent referring to an <i>@English</i> annotated
      <i>SpellChecker</i> will actually receive an implementation of type <i>FrenchSpellChecker</i>. There are no errors, and <i>EnglishEmailer</i> is unaware of
      any change and more importantly <i>unaffected</i> by any change. No client code needs to change, and we were able to alter configuration transparently. So they aren't really
      tightly coupled.
    </div>
  </div>


  <hr>
  <div id="Prasanna_Chapter3" class="chapter">Chapter 3: Investigating DI</div>
  <hr>

  <div class="textual-content">
    - In this chapter we will look at different injection idioms. We will see why we should favor constructor injection. We will also see when setter injection is favorable and how
    to decide between the two. Understanding injection idioms and the nuances behind them is central to a good grasp of dependency injection and architecture in general. <br>

    <div class="sub-heading">Injection idioms</div>
    <div>
      - The key to understanding the differences between setter and constructor injection is to understand the differences between methods and constructors. The advantages and
      limitations arise from these essential language constructs.

      <br>
      <br>

      <p class="inline-heading">1) Constructor Injection</p>: <br>
      - A constructor's purpose is to perform initial setup work on the instance being constructed, using provided arguments as necessary. This setup work may be wiring of
      dependencies (what we are typically interested in) or some computation that is necessary prior to the object's use. <br>
      - A constructor has restrictions that differentiate it from a normal method: <br>
      a) Cannot (does not) return anything <br>
      b) Must <i>complete</i> before an instance is considered fully constructed <br>
      c) Can initialize <code>final</code> fields, whereas a method cannot <br>
      d) Can be called only once per instance <br>
      e) Cannot be given an arbitrary name - in general, it is named after the class

      <br>
      <br>

      <p class="inline-heading">2) Setter Injection</p>: <br>
      - In case of setter injection, the wiring takes place <i>after</i> the instance has been fully constructed. <br>
      - The setter injection differs based on the DI framework that you are using. In the case of Spring, a setter directly refers to a property on the object and is set via the
      <code>&lt;property&gt;</code> XML element. <br>

      - This is what the class in the case of Setter Injection would look like. Also note that the setters in this case need to be declared as <code>public</code>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/25f39e6b4ad740776061b0621fd0a01a.js"></script>
        </div>
      </div>

      - And the XML configuration file would look like this. Note that if you misspell the name of the setter, Intellij is smart enough to give you a compile error. Also note that
      the order in which these setters are called usually matches the order of the <code>&lt;property&gt;</code> tags. This ordering is unique to the XML configuration
      mechanism and is not available with autowiring. <br>
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/af379c831a3c284bd07dafa7f00dccd3.js"></script>
        </div>
      </div>

      - Doing the same setter injection in the case of Guice would look something like this. Recall that for concrete classes dependency in the case of Guice, we do not need to
      bind them in the AbstractModule. So for this example, we can leave the AbstractModule class empty. Note that we have annotated the methods with <code>@Inject</code>.
      Interestingly, even if you remove the annotation from the method, the code still works. So the annotations are not mandatory? <br>
      - The order in which these setters are called is undefined, unlike with Spring's XML configuration. <br>
      - Another thing to keep in mind is that these setters are called by Guice itself, immediately after the constructor has been executed completely. So when you use this object,
      the object that you get finally is the fully-formed object. At no point do you have to call the setters manually yourself in order to set these dependencies on the object.
      The framework does that for you automatically like magic. Of course, nothing is stopping you from calling the setters yourself if you want to and set in a different object
      for these dependencies, but you do not HAVE to. And that is the important thing to keep in mind. All of the injection is happening behind the scenes, without you having to
      do things like: <code>Amplifier amp = new Amplifier(); amp.setGuitar(new Guitar()); amp.setSpeaker(new Speaker())</code> etc. before having to use the amp object.

      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/4c976c93e1467153e1606e0a39becd55.js"></script>
        </div>
      </div>

      - But one nice thing is that you do not need the setter naming convention in Guice, so you can rewrite this class in a more compact way.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/5655c2e4e4c7072dc5422378c479617e.js"></script>
        </div>
      </div>
      - Notice that this new setter now looks very much like a constructor, as in, it does not return anything, it accepts a bunch of dependencies, and it is called only once when
      the object is created by the injector. <br>
      - Guice does not place any restrictions on the name or visibility of setters either. So you can hide them from accidental misuse. In the above example, you could have
      declared the set up method as <code>@Inject private void setUp(...)</code>, and the code would STILL have worked. This is because Guice takes use of reflection, and
      reflection can do very weird things. But is this a good thing to do, declaring methods as <code>private</code> and using <code>@Inject</code> on top of that? I don't know.

      <br>
      <br>

      <p id="Ch3_InterfaceInjection" class="inline-heading">3) Interface Injection</p>: <br>
      - Interface injection is the same as setter injection except that each setter is housed in its own interface. This design is not commonly used. However, some of the ideas
      behind interface injection form the basis of important design patterns and solutions to several knotty design problems.

      <br>
      <br>

      <p id="Ch3_MethodDecoration" class="inline-heading">4) Method Decoration</p>: <br>
      - When they are called, these methods return an injector-provided value instead of their normal value. This process is called <i>decorating</i> the method and gets its name
      from the Decorator pattern. It is useful if you want to make a Factory out of an <i>arbitrary method</i> on your object. <br>
      - The problem that we are trying to solve is this. We want the <i>Candy</i> class to be wired and created by the injector. Hence, the way that we are manually creating and
      returning the object is not sufficient.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/2059eb24980682d798e22d153d0f8d9f.js"></script>
        </div>
      </div>

      - An alternative would be to have the <i>Sugar</i> dependency injected into the <i>Dispenser</i> class, and use that to create the <i>Candy</i> class. But this is also not
      optimal because we are reusing the SAME <i>Sugar</i> instance for every new <i>Candy</i> that we are creating. What we want is a <i>new</i> <i>Sugar</i> for a <i>new</i>
      <i>Candy</i>. Besides, <i>Dispenser</i> must know how to construct <i>Candy</i> and consequently is <i>tightly coupled</i> to its internals. Also, <i>Dispenser</i> is now
      cluttered with the dependencies of <i>Candy</i>.

      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/283bdf4bf42666b7622284f87ef62e70.js"></script>
        </div>
      </div>

      - Method Decoration gets around this problem in the following way. First we provide a <i>dummy</i> implementation of <i>dispense</i> in the code.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/e925c7ee1521d58cb1b7e55d8a467683.js"></script>
        </div>
      </div>

      - Then the actual impl of the <i>Candy</i> class is done in the XML files as follows. Read more about this approach <a
      href="https://stackoverflow.com/questions/20261769/how-to-configure-spring-lookup-method-with-spring-property">here on SO</a>. What we have basically ended up doing is
      injecting a prototype-scoped bean (<i>Candy</i>) into a singleton-scoped bean (<i>Dispenser</i>).
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/39a27aa80625af1a42ea9fc47e241b1b.js"></script>
        </div>
      </div>

      <br>

      <p class="inline-heading">5) Field Injection</p>: <br>
      - You can also wire dependencies directly into the fields.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/d7f0feec9bf16417b4043425acafd631.js"></script>
        </div>
      </div>
      - Annotating fields <i>barley</i> and <i>yeast</i> with <code>@Inject</code> tells the injector to wire dependencies directly to them when <i>BrewingVat</i> is requested.
      This happens after the class's constructor has completed and before any annotated setters are called for setter injection. <br>
      - Without the ability to set dependencies (whether mocked or real) for testing, unit tests cannot be relied on to indicate the validity of code. It is also not possible to
      declare field-injected fields immutable, since they are set post construction. So, while field injection is nice and compact (and often good for examples), it has little
      worth in practice.
    </div>

    <div class="sub-heading">Choosing an Injection Idiom</div>
    <div>
      - We are going to be comparing the constructor injection and the setter injection idioms as they are the ones that are the most frequently used.

      <br>
      <br>

      <p class="inline-heading">1) Constructor vs Setter Injection</p>: <br>
      - The merits and demerits of using either constructor or setter injection are the same as those for setting <i>fields</i> by either constructor or setters. <br>
      - An important practice regards the <i>state</i> of fields once set. In most cases we want fields to be set once (at the time the object is created) and never modified again.
      This means not only that the dependent can rely on its dependencies throughout its life but also that they are ready for use right away. Such fields are said to be
      <i>immutable</i>. The basic idea is that once the dependency object graph has been created, the graph is fixed, and no changes can be done to the graph whatsoever. <br>
      - If you think of private member variables as a <i>spatial</i> form of encapsulation, then immutability is a form of <i>temporal</i> encapsulation, that is, unchanging with
      respect to time. With respect to dependency injection, this can be thought of as <i>freezing</i> a completely formed object graph. Constructor injection affords us the
      ability to create immutable dependencies by declaring fields as <code>final</code>. <br>
      - Immutability is essential in application programming. Unfortunately, it is not available using setter injection. Because setter methods are no different from ordinary
      methods, a compiler can make no guarantees about the one-call-per-instance restriction that is needed to ensure field immutability. <br>
      - A second advantage to using constructor injection is that the object becomes fully available for use immediately. I.e. if a dependency were not provided, either in the
      configuration, or in a unit test, a compiler error would have alerted us to a misconfiguration immediately. Contrast this with a setter injection. Suppose you forgot to add
      <code>@Inject</code> on a setter, you wouldn't realize that you missed it unless you tried to execute some method on the injected object, ultimately resulting in a NPE
      (because the dependency was never set by the injector). Similarly, if you were writing tests for a class using constructor injection, you would just have to call the
      constructor, and would be enough for the <code>setUp()</code>. But in the case of using setter injection, you need to call the constructor, and then separately have to call
      each of the setters on the object to set the required dependencies before being able to run any of the tests. Not cool. <br>
      - One problem with the constructor injection though is that if your object requires multiple dependencies which are of the same type, it is easy to get the order of the
      dependencies mixed up and end up with a malformed object. The error goes <i>completely</i> undetected. Imagine a case where you have like 8 string args in a constructor.
      Compare this to if we were using setter injection, and it would have been very easy to give meaningful names to the setters, thus minimizing any chances of such errors.

      <br>
      <br>

      <p class="inline-heading">2) The Constructor Pyramid Problem</p>: <br>
      - When you have different object graph permutations of the same object, the number of constructors can get out of hand, which becomes confusing when it comes to deciding
      which constructor to make use of. <br>
      - Consider the following <i>Amphibian</i> class:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/af9b031e88163c1ac9702c8757b1d2d4.js"></script>
        </div>
      </div>
      - Here we require two mutually exclusive constructors that match either profile but not both. Were you to require more such profiles, there would be more constructors, one
      for each case. All these constructors differ by is the type of argument they take; unlike setters, they can't have different names. This makes them hard to read and to
      distinguish from one another. Where an object requires only a partial set of dependencies, additional, smaller constructors need to be written, further adding to the
      confusion. This issue is called the <i>constructor pyramid problem</i>, because the collection of constructors resembles a rising pyramid. On the other hand, with setters,
      you can wire any permutation of an object's dependencies without writing any additional code. <br>
      - If you find yourself encountering the pyramid problem often, you should ask serious questions about your design befor pronouncing setter injection as a mitigant.

      <br>
      <br>

      <p class="inline-heading">3) The Circular Reference Problem </p>: <br>
      - The problem becomes when you are trying to create an object graph that looks like this. The constructor for a <i>Symbiote</i> requires a <i>Host</i>, and the constructor
      for <i>Host</i> requires a <i>Symbiote</i>. Both of them refer to the <i>same</i> instances of each other. Syntactically, there is no conceivable way to construct these
      objects so that circularity is satisfied with constructor wiring alone. If you decide to construct <i>Host</i> first, it requires a <i>Symbiote</i> as dependency to be valid.
      So you are forced to construct <i>Symbiote</i> first; however, the same issue resides with <i>Symbiote</i>.
      <img src="imgs/ch3/CircularDependencyProblem.png"
           class="center-block img-fluid"
           alt="CircularDependencyProblem"
           width="1500">

      - This classic chicken-and-egg scenario is called the <i>circular reference problem</i>. The triangle one is more commonly seen in the wild. <br>
      - There are two possible solutions to this, using setter or constructor injection. <a href="https://www.baeldung.com/circular-dependencies-in-spring">This link on
      baeldung</a> explains how to solve this issue in the case of Spring. <br>
      - Refer <a href="https://github.com/google/guice/wiki/CyclicDependencies">this page on Guice docs</a> to read about cyclical dependencies and how to get around them.
      <a href="https://stackoverflow.com/questions/36042838/avoiding-framework-imposed-circular-dependencies-in-guice">This SO answer</a> goes into detail about how Guice works to
      resolve circular dependency issues. <a href="https://stackoverflow.com/questions/39947729/spring-and-guice-when-di-frameworks-create-proxies">This answer on SO</a> explains
      the scenarios in which Spring creates proxies. <br>


      <br>
      <br>

      <p class="inline-heading">Spring - using setter injection to solve the issue</p>: <br>
      - The setter injection solution is to just switch to setter injection. When the injector starts up, both host and symbiote object graphs are constructed via their nullary
      (zero-argument) constructors and then wired by setter to reference each other. The drawback of this approach is that the dependencies can now no longer be declared as
      <code>final</code>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/d7b8a7ed67c12a4b4239de3e4f867523.js"></script>
        </div>
      </div>

      - And the XML Configuration file would look like this:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/487569b866a932ad6e35afa5f398eba1.js"></script>
        </div>
      </div>

      <br>

      <p class="inline-heading">Spring - using constructor injection to solve the issue</p>: <br>
      - Solving this by using constructor injection requires us to use a <i>proxy</i> object. First we decouple the <i>Host</i> and the <i>Symbiote</i> so that they use interfaces.
      The concrete classes <i>HostImpl</i> and <i>SymbioteImpl</i> now have dependency on the interfaces instead of the concrete classes. We have introduced a new class
      <i>HostProxy</i> that implements the same interface that the <i>HostImpl</i> implements. Unlike <i>HostImpl</i>, <i>HostProxy</i> has a zero-dependency constructor. This
      means we can now carry out the following sequence of steps in order to form the object graph: <br>
      a) Construct <i>HostProxy</i> <br>
      b) Construct <i>SymbioteImpl</i> using the instance of <i>HostProxy</i> created in step 1 <br>
      c) Construct <i>HostImpl</i> using the <i>SymbioteImpl</i> created in step 2 <br>
      d) Call the setter <i>setDelegate</i> on <i>HostProxy</i> by passing in the <i>HostImpl</i> created in step 3
      <img src="imgs/ch3/ConstructorSolutionByCreatingProxy.png"
           class="center-block img-fluid"
           alt="CircularDependencyProblem"
           width="2500">
      - (From the gang of four book) Delegation is basically defined as follows: Delegation is a way of making composition as powerful for reuse as inheritance. In delegation, two
      objects are involved in handling a request: a receiving object delegates operations to its <i>delegate</i>. This is analogous to subclasses deferring requests to parent
      classes. <br>
      - For example, instead of making class Window a subclass of Rectangle (because windows happen to be rectangular), the Window class might reuse the behavior of
      Rectangle by keeping a Rectangle instance variable and <i>delegating</i> Rectangle-specific behavior to it. In other words, instead of a Window <i>being a</i> Rectangle, it
      would <i>have a</i> Rectangle. Window must now forward requests to its Rectangle instance explicitly, whereas before it would have inherited those operations. <br>
      - This is the same concept that we are also using over here. The <i>HostProxy</i> is supposed to simply delegate the requests that it gets for performing operations on the
      <i>Host</i> object to the actual implementation of the <i>Host</i> type (<i>HostImpl</i>) that it has saved. <br>
      - Question: Well even though the <i>Host hostProxy</i> field on <i>SymbioteImpl</i> has been marked as <code>final</code>, the <code>setDelegate</code> method allows you
      to change the underlying reference of <i>Host</i> as and when you like. So where is the immutability that was promised? Hmm? <br>
      - This is what the code looks like when we are using Constructor Injection in order to solve the circular dependency issue:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/f47d0dc71ee0ff52a3cb9aa6a870fc14.js"></script>
        </div>
      </div>
      - And this is what the XML Config corresponding to the code looks like:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/5fd645d972e370d6983af6f05aa3a4b9.js"></script>
        </div>
      </div>

      <br>
      <p class="inline-heading">Spring - using annotations to solve the issue</p>: <br>
      - You can get Spring to create the proxies automatically by using the <code>@Lazy</code> annotation. <br>
      - This is what the code looks like in this scenario:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/fb4972ed4ecc967a80f12811212a0a7e.js"></script>
        </div>
      </div>
      - Sice we are using annotations, the XML files are going to look pretty vanilla.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/187396c85630d0150d3b10363230642e.js"></script>
        </div>
      </div>

      <br>
      <p class="inline-heading">Guice - using annotations to solve the issue</p>: <br>
      - In the case of Guice, all you need to do is extract the classes to an interface of its own (a step that we have already done) and then bind the classes to their resp.
      implementation in the Guice module. The Guice injector automatically provides the proxy in the middle. We can also trust the injector to work out the correct order of
      construction. We don't deal directly with proxies or setter injection or any other infrastructure concern.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/1a979943b20066599acfc956e2699cd5.js"></script>
        </div>
      </div>

      - And the module itself looks something like this:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c8bf8ad5a86509940af5e51756379428.js"></script>
        </div>
      </div>

      <br>
      <br>

      <p class="inline-heading">4) The In-Construction Problem</p>: <br>
      - One close relative of the circular reference problem that we saw above is where initialization logic requires a dependency that is not yet ready for use. What this
      typically means is that a circular reference was solved with a proxy, which has not yet been wired with its delegate. <br>
      - This example code is building up on the example that we discussed in the circular dependency problem. Since Host has been proxied but does not yet hold a valid reference to
      its delegate, it has no way of passing through calls to the dependency. This is the in-construction problem in a nutshell. The only recourse in such cases is setter
      injection. <br>
      - Example code here is in Spring using the same config xml file that we used above.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c1070bf081c96e2eed4c6d6be3417932.js"></script>
        </div>
      </div>

      - The above problem can be solved by just using setter injection instead of constructor injection as follows:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">

        </div>
      </div>

      - But even the setter injection cannot solve this problem if instead of just the symbiote making use of the host, we now have the host making use of the symbiote as well.
      Idk man. This seems to be working for some reason. I have no idea what is going on. This code is present <a
      href="https://github.com/rgbk21/DIBookCode_Guice/tree/master/src/main/java/Chapter3/InConstructionProblemWithoutSolution">here on Github</a>. Figure out what is happening I
      guess...

      <br>
      <br>

      <p id="Ch3_ConstructorInjection_ObjectValidity" class="inline-heading">5) Constructor Injection and Object Validity</p>: <br>
      - If you use setter injection, you require a lot of upfront work in order to make sure that all the dependencies have been injected properly. For instance, suppose we were
      trying to set up Spring to wire in the following objects:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/33131c7859bc0a04701c84001c60c8e8.js"></script>
        </div>
      </div>

      - The XML file would look like this:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/bebc3415a162734e357a9fe6bbf8731f.js"></script>
        </div>
      </div>

      - We would have to make sure of a bunch of things: <br>
      a) We have to remember to set both of the setters manually by using the <code>property</code> tags. <br>
      b) We have an <i>init</i> method defined in the class, that needs to be manually set up as well by using the <code>init-method</code> tag. <br>
      c) Objects in Spring are Singletons by default. This means that other multiple threads are concurrently accessing <i>unsafeObject</i>. While the injector is itself safe to
      concurrent accesses of this sort, <i>UnsafeObject</i> may not be. The Java Memory Model makes no guarantees about the visibility of non-<code>final</code>,
      non-<code>volatile</code> fields across threads. To fix this, you can remove the concept of shared visibility, so an instance is exposed to only a single thread. We do this
      by scoping each bean to a <code>prototype</code>. This tells the injector to create a new instance of <i>UnsafeObject</i> each time it is needed. Now there are no concurrent
      accesses to <i>UnsafeObject</i>. Notice that you are forced to mark both dependencies with <code>scope="prototype"</code> as well. Otherwise they may be shared
      <i>underneath</i>. <br>
      - You were also confused about the order in which the methods would be called: <br>
      Inside the UnsafeObject constructor -&gt;
      Inside the constructor for Shady -&gt;
      Inside the constructor for Slippery -&gt;
      Inside the setShady method -&gt;
      Inside the setSlippery method -&gt;
      Inside the init method (init method is called only after the setter dependencies have been set) <br>
      - We can solve all of these issues in one go by simply using Constructor Injection. There is only one way to construct it, since it exposes only the one constructor.
      Both dependencies are declared <code>final</code>, making them safely published and thus guaranteed to be visible to all threads. Initialization is done at the end of the
      constructor. And <i>init()</i> is now private, so it can't accidentally be called after construction.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/9a3021b23c114f81072a7420740ee2d3.js"></script>
        </div>
      </div>
    </div>


    <div class="sub-heading">The Reinjection Problem</div>
    <div>
      - This problem is about injecting an object that has already been injected once earlier. Reinjection is typical in cases where you have a long-lived dependent with
      short-lived dependencies. For instance, consider an example of a dialog box that opens up when a button is clicked and accepts some user text. Every time that the user clicks
      on the button, you would want a new dialog box to be created, so that the text that was input the previous time does not show. <br>
      - Consider the following example. <i>Granny</i> is given one apple when she comes into existence. Upon being told to <i>eat()</i>, she consumes that apple but is still
      hungry. The apple cannot be consumed again since it is already gone. In other words, the <i>state of the dependency has changed</i> and it is no longer usable. <i>Apple</i>
      is short-lived, while <i>Granny</i> is long-lived, and on each use (every time she eats), she needs a new <i>Apple</i>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c0d91e91056d958a45310ac2f079d8a4.js"></script>
        </div>
      </div>

      - One solution to the problem would be the <a href="#Ch3_MethodDecoration">method decoration solution</a> that we saw above. There we were also returning a prototype-scoped
      bean from a singleton-scoped bean. We could use the same thing here as follows. But this belies our original object graph (of <i>Granny</i> depending on an <i>Apple</i>) and
      more importantly is difficult to test. One alternative to this solution is using the <code>Provider</code> pattern that we are going to look at next.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/1168b9ce399195237b671ab9136ea3a6.js"></script>
        </div>
      </div>
    </div>

    <div class="sub-heading">Reinjection with the Provider Pattern - Using <code>Provider&lt;T&gt;</code></div>
    <div>
      - Provider pattern is a Factory that the injector creates, wires, and manages. It contains a single method, which provides new instances. It is particularly useful
      for solving the reinjection problem, since <i>a dependent can be wired with a Provider rather than the dependency itself</i> and can obtain instances from it as necessary.

      <br>
      <br>

      <p id="Ch3_ProviderPatternGuice" class="inline-heading">Using Provider pattern with Guice</p>: <br>
      - This is an example of how we would set the Provider pattern up. Note that no injector configuration apart from this was required in order to set this up. Guice is clever
      enough to work out how to give you an <i>Apple</i> provider.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/40aced07d73559b182cd88e3062e8371.js"></script>
        </div>
      </div>

      - There a couple of things that we can say about the Providers: <br>
      a) A Provider is unique (and specific) to the type of object it provides. This means you don't do any downcasting on a <code>get()</code> as you might do with a Service
      Locator. <br>
      b) A Provider's only purpose is to provide scoped instances of a dependency. Therefore, it has just the one method, <code>get()</code>. Guice provides Providers out of the
      box for all bound types. <br>
      - This is what the <code>Provider</code> interface in Guice looks like. Method <code>get()</code> is fairly straightforward: it says get me an instance of
      <code>T</code>. This may or may not be a new instance depending on the scope of <code>T</code>. For example, if the key is bound as a singleton, the same instance is returned
      every time.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/8c94c7a1cf36e77ccdffc7a8a673e256.js"></script>
        </div>
      </div>

      <br>
      <p id="Ch3_ProviderPatternSpring" class="inline-heading">Using Provider pattern with Spring</p>: <br>
      - Spring does not have a Provider class out of the box. But we can create a Provider of our own and use it pretty much in the same way that we did with Guice.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/74c5fefcaca630f56161aaa5caaadad3.js"></script>
        </div>
      </div>

      - And the XML Config will look something like this. Note that we also had to declare the <i>beans.apple</i> as <code>prototype</code> in order for a new instance of
      <i>Apple</i> to be returned everytime. Note that for the <i>AppleProvider</i> class, we did not have to explicitly tell Spring to wire-in the injector. Spring was able to
      look at the <code>BeanFactoryAware</code> interface and able to inject it automatically. <code>BeanFactoryAware</code> is an example of the Interface Injection that we
      looked at above in <a href="#Ch3_InterfaceInjection">Interface Injection section</a>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/97ddf777b5e210e500cf60a9fd34305f.js"></script>
        </div>
      </div>
    </div>


    <div class="sub-heading">The Contextual Injection Problem - Using Custom Factory and <code>@Assisted</code></div>
    <div>
      - There are some cases where we might want to do partial injection, i.e. have the injector wire up some dependencies for us and provide some dependencies ourselves (for eg. a
      text that has been entered by the user). <br>
      - <a href="https://stackoverflow.com/questions/8976250/how-to-use-guices-assistedinject">This SO Link</a> explains Assisted Inject. <br>
      - Consider the following example. The <i>Deliverer</i> instance that we want to create has 3 dependencies. Suppose <i>EmailService</i> is supposed to be injected by the
      injector, whereas the other two dependencies, <i>NewsLetter</i> and <i>date</i> need to supplied by the instance's creator.
      <img src="imgs/ch3/NewsLetterManager_WithoutAnnotation.png"
           class="center-block img-fluid"
           alt="NewsLetterManager"
           width="800">

      - In such a case, the standard solution is to write a factory that helps Guice build the objects. <i>NewsLetterManager</i> needs an instance of <i>Deliverer</i> in order to
      send the newsletter to its list of recipients. We cannot create the <i>Deliverer</i> object in the way that we have been doing so far because we need to pass in two args to
      the object ourselves. We are doing this by creating a factory, <i>DelivererFactory</i>. <i>NewsLetterManger</i> makes the use of <i>DelivererFactoryImpl</i> in order to
      obtain an instance of <i>Deliverer</i>.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/af3cfdeecea1ce03ca637287afe9d7b7.js"></script>
        </div>
      </div>

      - Instead of creating a Factory ourselves, we can get Guice to create a factory for <i>Deliverer</i> for us, and then we can just inject the factory whenever we need an
      instance of <i>Deliverer</i>. This is what the UML looks like in the case when we do use Annotation. The <i>Deliverer</i> class is going to contain the <i>Factory</i>
      interface. The params passed to the factory interface will be the same params that we want to pass in manually. The corresponding args on the <i>Deliverer</i> constructor
      itself will have to be annotated with <code>@Assisted</code> and the constructor will have to be annotated with <code>@Inject</code>. This <i>Factory</i> will have to be
      injected into the <i>NewsLetterManager</i> constructor because that is where we are originally making use of the <i>Deliverer</i> class. We call <i>create</i> there, which
      goes to the <i>Deliverer.Factory</i> interface, from where Guice automatically creates an implementation of the Factory for us. This is by telling Guice to do so in the
      <i>GuiceModule</i> class. Guice creates the implementation of the <i>Factory</i> and returns back a fully-formed <i>Deliverer</i> object for us.
      <img src="imgs/ch3/NewsLetterManager_WithAnnotation.png"
           class="center-block img-fluid"
           alt="NewsLetterManager"
           width="500">

      - So much talking. Does it even help clear things up? This is what the code looks like.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/8a8629e423da8c54737961706bd0d81d.js"></script>
        </div>
      </div>
    </div>

    <div class="sub-heading">Using <code>@Assisted</code> with multiple args that are of the same type - Using <code>@Named</code></div>
    <div>
      - Suppose in the above example, we needed to pass an additional <code>String</code> param to the constructor of the <i>Deliverer</i> class called <i>name</i> that would also
      have to be provided by the instance's creator (just like the <i>date</i> param for exmaple). We would then need to add this param to the <i>Factory</i> interface. But this
      won't work. If we try to run the code, we will get an error. <br>
      - <a href="https://stackoverflow.com/questions/23553865/using-assisted-inject-with-multiple-params-of-same-type-named-params">This SO post</a> explains the problem and the
      solution. <a href="https://google.github.io/guice/api-docs/latest/javadoc/com/google/inject/assistedinject/FactoryModuleBuilder.html">Java Doc for </a>
      <code>FactoryModuleBuilder</code>. <br>
      - You get the following error when you do this: <code>String annotated with @Assisted(value="") was bound multiple times</code>. Learn more at <a
      href="https://github.com/google/guice/wiki/BINDING_ALREADY_SET">this link</a>. <br>
      - The types of the factory method's parameters must be distinct. To use multiple parameters of the same type, use a named <code>@Assisted</code> annotation to disambiguate
      the parameters. The names must be applied to the factory method's parameters and to the concrete type's constructor parameters. Hence the class would now look something like
      this. The places where we changed the code are commented with // changed here.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/3885dbdba4ab4ffc2ceee617c4e1e675.js"></script>
        </div>
      </div>
    </div>

    <div class="sub-heading">Similar functionality in Spring as <code>@Assisted</code>?</div>
    <div>
      - The following two links on SO discuss couple of ways in which this could be achieved: <br>
      a) <a href="https://stackoverflow.com/questions/6222460/is-it-possible-and-how-to-do-assisted-injection-in-spring">Is it possible and how to do Assisted Injection in
      Spring?</a> <br>
      b) <a href="https://stackoverflow.com/questions/42987414/partial-auto-wire-spring-prototype-bean-with-runtime-determined-constructor-argu">Partial auto-wire Spring prototype
      bean with runtime determined constructor arguments</a> <br>

      - Here I am following a slightly different approach compared to the above two links, but one that we had done previously in the <code>Provider</code> approach for Spring
      <a href="#Ch3_ProviderPatternSpring">here</a>. The same <code>BeanFactoryAware</code> method is being used to create a Factory that can form the <i>Deliverer</i> object for
      us consisting partially of dependencies injected from the container, and runtime values added by us.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/2164a73e2940091fc6d0081deb43c45d.js"></script>
        </div>
      </div>
    </div>


    <div class="sub-heading"><code>@Provides</code> annotation vs the <code>Provider</code> class</div>
    <div>
      - <a href="https://stackoverflow.com/questions/28202882/guice-provides-methods-vs-provider-classes?">Guice @Provides Methods vs Provider Classes?</a> <br>
      - <a href="https://stackoverflow.com/questions/30153765/guice-provider-vs-toprovider-binding">@Provides vs toProvider binding</a>
    </div>

    <div class="sub-heading">Flexible partial injection using the Builder Pattern</div>
    <div>
      - // TODO: <br>
      - Refer the Gang of Four book for the Builder pattern. Refer the text for this.
    </div>

    <div class="sub-heading">Injecting objects in sealed code</div>
    <div>
      - // TODO: <br>
      - Goes over how you can use the Adapter Pattern to inject dependencies into third-party code??
    </div>
  </div>

  <hr>
  <div id="Prasanna_Chapter4" class="chapter">Chapter 4: Building Modular Applications</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">Understanding the role of an object</div>
    <div>
      - An object is: <br>
      a) A logical grouping of data and related operations <br>
      b) An instance of a class of things <br>
      c) A component with specific responsibilities <br>
      - An object is all these things, but it is also a building block for programs. And as such, the design of objects is paramount to the design of programs themselves. Classes
      should have a specific, well-defined purpose and stay within clearly defined boundaries. Each object has its area of concern. Good design keeps those concerns separated.
    </div>


    <div class="sub-heading">Separation of concerns</div>
    <div>
      - Earlier we laid down the principle: separating infrastructure from application logic so that logic that dealt with construction, organization, and bootstrapping was housed
      independently from core business logic. If you think of infrastructure as being orthogonal to application logic, then separating the two can be seen as dividing horizontally.
      <br>
      - Similarly, logic dealing with different business areas can be separated vertically. Checking spelling and editing text are two core parts of any email application. Both
      deal with application logic and are thus focused on business purpose. However, neither is especially related to the other. In other words, separating logic by area of concern
      is a good practice.
      <img src="imgs/ch4/AppArchitecture_SeparationOfConcerns.png"
           class="center-block img-fluid"
           alt="CircularDependencyProblem"
           width="850">
    </div>


    <div class="sub-heading">Perils of tight coupling</div>
    <div>
      - Recall the very first incarnation of <i>Emailer</i> that we wrote:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/b8be3cd32369ab39bd09f6e334f47985.js"></script>
        </div>
      </div>

      - This email service was poorly written because it encapsulated not only its dependencies but also the <i>creation</i> of its dependencies. Following are the problems with
      this: <br>
      a) It prevents any external agent (like the injector) from reaching its dependencies. By preventing any external agent from reaching its dependencies, not only does it
      prevent an injector from creating and wiring them, it prevents a unit test from substituting mock objects in their place.<br>
      b) It allows for only one <i>particular</i> structure of its object graph (created in its constructor). By deciding its own dependencies, Emailer prevents any variant of
      them from being created. This makes for poor reuse and a potential explosion of similar code, since a new kind of Emailer would have to be written for each permutation<br>
      c) It is forced to know how to construct and assemble its dependencies. <br>
      d) It is forced to know how to construct and assemble dependencies of its dependencies, and so on ad infinitum. <br>
      - When a dependent is inextricably bound to its dependencies, code is no longer testable. This, in a nutshell, is <i>tight coupling</i>. Tight coupling also means that we
      have opened the door in the iron wall separating infrastructure from application logic - something that should raise alarm bells on its own.<br>
      - <a href="https://stackoverflow.com/questions/2832017/what-is-the-difference-between-loose-coupling-and-tight-coupling-in-the-object-o">What is the difference between loose
      coupling and tight coupling in the object oriented paradigm?</a> on SO. <br>
      - <a href="https://softwareengineering.stackexchange.com/questions/150045/what-is-the-point-of-having-every-service-class-have-an-interface">What is the point of having every
      service class have an interface?</a> on SE. <br>
    </div>


    <div class="sub-heading">Programming to a contract</div>
    <div>
      - An example of a class with tight coupling. In the following example, if we wanted to search for the <i>startsWith</i> in an <code>ArrayList</code> instead of a
      <code>HashSet</code>, we would have to change the type of the dependency being passed in into the constructor.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c98508e9ea1f2c3abdbcaa9f3ec6a3e3.js"></script>
        </div>
      </div>

      - An example of implementation of the class with loose coupling. By placing an abstraction between dependent and dependency (the interface <code>Collection</code>), the code
      loses any awareness of the underlying data structure and interacts with it only through an interface.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/5857cec4573f34b119724f493ffb7dc3.js"></script>
        </div>
      </div>
    </div>


    <div class="sub-heading">Rebinding Dependencies</div>
    <div>
      - The basic idea is altering dependency bindings at runtime. It refers purely to changing the association of a key to an object graph. This is what enables hot deployment of
      changes. But there are multiple pitfalls that need to be kept in mind: <br>
      a) Once bound, a key provides instances of its related object until rebound. <br>
      b) When you rebind a key, all objects already referencing the old binding retain the old instance(s). <br>
      c) Rebinding is very closely tied to scope. A longer-lived object holding an instance of a key that has been rebound will need to be reinjected or discarded altogether. <br>
      d) Rebinding is also tied to lifecycle. When significant dependencies are changed, relevant modules may need to be notified. <br>
      e) Not all injectors support rebinding, but there are alternative design patterns in such cases. <br>
      - It encapsulates any infrastructure logic and can be used in place of the original dependency with no impact to client code. A change in the binding is signaled to the
      adapter(s) via a rebinding notification, and the adapter shifts to the new binding. While this is a robust and workable solution, it is fraught with potential pitfalls and
      should be weighed carefully before being embarked upon. <br>
      - There is a difference between hot-deploy and hot-swap as mentioned in <a href="http://arhipov.blogspot.com/2016/02/hotswap-vs-hot-deploy_12.html">this blog post</a>.
      <a href="https://stackoverflow.com/questions/35249234/how-hot-deployment-works-internally">This SO answer</a> goes into details about how hot-deploy is done. <br>
      - <a href="https://stackoverflow.com/questions/34473125/why-is-javas-debugging-hot-swap-limited-to-intra-method-changes">This is a SO answer</a> about how hot-swap works.
    </div>


    <div class="sub-heading">Rebinding Dependencies - The Simple Way</div>
    <div>
      - Here we are considering a case where we are using an injector that does not support dynamic rebinding. The problem that we are trying to solve is that there isn't enough
      knowledge while coding to bind all the dependencies appropriately. In other words, the structure of the object graph might change over the course of the life of the
      application. <br>
      - One very simple solution is to maintain both object graphs and simply flip the switch when you need to move from one object graph to another. Here the method
      <i>rebind()</i> controls which dependency <i>LongLived</i> uses. At some stage in its life, when the rebinding is called for, you need to make a call to <i>rebind()</i>. The
      problem with this approach is that we end up mixing infrastructure logic with our application logic.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/8fbf63e32dc32eeba27a1759116a93fa.js"></script>
        </div>
      </div>

      - What's really needed is an abstraction, an intermediary to which we can move the rebinding logic and still remain totally transparent to clients. We can achieve this by
      using the adapter pattern. An <i>adapter</i> is supposed to inherit its <i>adaptee</i>.
    </div>


    <div class="sub-heading">Adapter Pattern</div>
    <div>
      - Adapter pattern is used to convert the interface of a class into one that the client is expecting. We achieve this by wrapping the object that has an incompatible interface
      with an object that implements the correct one. <br>
      - // TODO: Add text in detail about what Adapter Pattern is, and how it actually works. <br>
      - <a href="https://www.baeldung.com/java-adapter-pattern">Adapter pattern on Baeldung</a> <br>
      - <a href="https://refactoring.guru/design-patterns/adapter/java/example">Adapter pattern on Refactoring</a>
    </div>


    <div class="sub-heading">Rebinding Dependencies - Adapter Pattern</div>
    <div>
      - This is how you would use the Adapter Pattern to achieve the same result:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/0f5aa0b7df5031931067feb2a8707ff6.js"></script>
        </div>
      </div>

      - And the Guice module would look something like this. Note that we had to declare the <i>DependencyAdapter</i> as a <code>Singleton</code>. This was to make sure that the
      same <i>DependencyAdapter</i> that is being injected into the <i>LongLived</i> class is the same one on which we are calling the <i>rebind()</i> method in the test class.
      If you remove the <code>Singleton</code> declaration, then the <i>rebind</i> is called on a different instance of <i>DependencyAdapter</i>, and hence both calls of the
      <i>compute()</i> method end up being called on the <i>DependencyA</i> instance.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/a09d3a7668f5ec7851d82359b53c2705.js"></script>
        </div>
      </div>

      - Now most of the infrastructure code has been moved to <i>DependencyAdapter</i>. When the rebinding occurs, flag useA is set to false and the adapter changes, now delegating
      calls to <i>DependencyB</i> instead. <br>
      - One interesting feature of this is the use of a <i>Rebindable role interface</i>. The control logic for dynamic rebinding is thus itself decoupled from the "rebinding"
      adapters. All it needs to do is maintain a list of <i>Rebindable</i>s, go through them, and signal each one to <i>rebind()</i> when appropriate. (Question: What?). Rebinding
      of the key associated with <i>Dependency</i> is now completely transparent to <i>LongLived</i> - and any other client code for that matter. <br>
      - Picture, because why not:
      <img src="imgs/ch4/LongLived.png"
           class="center-block img-fluid"
           alt="LongLivedClassStructure"
           width="800">
    </div>
  </div>


  <hr>
  <div id="Prasanna_Chapter5" class="chapter">Chapter 5: Scope - A Fresh Breath of State</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">What is Scope?</div>
    <div>
      - Scope is a way of specifying a context under which a key refers to the same instance. When the scope context ends, the instance which is bound to the particular key is
      discarded, and is no longer injected in other instances. You are basically telling the injector that a particular key is bound to an object only within a specific scope. <br>
      - This has some benefits: <br>
      a) It lets the injector manage the <i>latent state</i> of your objects <br>
      b) It ensures that your services get new instances of dependencies as needed <br>
      c) It implicitly separates state by context (for eg. two HTTP requests specifies two different contexts). This means that code working in a context is oblivious to that
      context. It is the injector's responsibility to manage these contexts. <br>
      d) It reduces the need for <i>state-aware</i> application logic
    </div>

    <div class="sub-heading">What is the importance of 'Context' in Scope?</div>
    <div>
      - Consider the following scenario: there are three people in a family. There is one bathroom in which there can be exactly one toothpaste. Each of the three members of the
      family need to use the toothpaste. Since the bathroom is shared by all of the family members, all the family members end up using the same instance of the <i>Toothpaste</i>.
      Then in this example, the bathroom is an example of a <i>context</i>. Ignore the details currently, and just try to think on a high-level. In this case, we would say that the
      <i>Toothpaste</i> is <i>Singleton</i> scoped.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/79eec06fd12d691e4e59ff42f8c2f41c.js"></script>
        </div>
      </div>

      - In contrast, if each family member had their own bathroom (each with it's own toothpaste), then a <i>new</i> instance of <i>Toothpaste</i> would be available to each family
      member. In this case, the context under which each object operates is unique (that is, its own bathroom). This is like the <i>Toothpaste</i> having no scope at all. This is
      referred to as <i>no-scope</i> or <i>prototype</i> scope.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c3b22e881530b8fd51ec108a14a5dd27.js"></script>
        </div>
      </div>

      - No code changes were done between the above two cases. All we did was change the context.
    </div>

    <div class="sub-heading">No-scope/Prototype</div>
    <div>
      - In a sense, no-scope fulfills the functions of scope, as it: <br>
      a) Provides new instances transparently <br>
      b) Is managed by the injector <br>
      c) Associates a service (key) with some context <br>
      - The first two points are self evident. But the last one is not. It's not even true. It is difficult to point out what is the scope that no-scope represents. <br>
      - Consider the example that we looked at above. We saw that we could alter the scopes of the objects without making any changes to the objects themselves. To be more precise,
      the <i>family.give()</i> sequence looked exactly the same for both the singleton as well as the no-scope setup. In that example, we equated the scope of a <i>toothpaste</i>
      with a <i>bathroom</i> context, and said that each instance of <i>bathroom</i> gets its own instance of <i>toothpaste</i>. But that is not entirely correct. <br>
      - Suppose if Charlie wanted to brush his teeth twice daily. In that case, when we asked for a <i>toothpaste</i>, he would have received a completely new instance of it. So
      now we would have had three instances of <i>bathroom</i>s, but four instances of <i>toothpaste</i>s. <br>
      - This means that no scope cannot be relied on to adhere to any conceptual context. No scope means that every time an injector looks for a given key (one bound under no
      scope), <i>it will construct and wire a new instance</i>. <br>
      - You can think of no-scope as a split-second scope where the context is entirely tied to referents of a key. <br>
      - This becomes very useful when you are trying to inject dependencies in a long-lived object, like we did in the Granny eating example using Provider Pattern <a
      href="#Ch3_ProviderPatternGuice">here</a>. There, <i>Apple</i> was no-scoped. <br>
      - Guice and Spring differ in nomenclature with regard to the no scope. Spring calls it as the <i>prototype</i> scope, the idea being that a key (and binding) is a kind of
      template (or prototype) for creating new objects. <br>
      - Recall in <a href="#Ch3_ConstructorInjection_ObjectValidity">this section in Chapter 3</a> where we used prototype instances of the objects.
    </div>

    <div id="Ch5_SingletonScope" class="sub-heading">Singleton Scope</div>
    <div>
      - A Singleton's context is the injector itself. The life of a singleton is tied to the life of the injector. Therefore, only one instance of a singleton is ever created per
      injector. <br>
      - It is important to emphasize this last point, since it is possible for multiple injectors to exist in the same application. In such a scenario, each injector will hold a
      different instance of the singleton-scoped object. This is important to understand because many people mistakenly believe that a singleton means one instance for the entire
      life of an application. In dependency injection, this is not the case.
    </div>

    <div class="sub-heading">Diagram explanation for Singleton vs Prototype Scope</div>
    <div>
      - In the case of a prototype scoped binding, a new instance is returned by the injector everytime that a new object is requested by using its binding. Because of this reason,
      prototype does not lend itself to a context. <br>
      - On the other hand, in the case of a Singleton scoped binding, we can establish a context quite easily. A singleton's context is the injector itself. As long as the injector
      exists, the singleton object will exist as well. There is a small subtlety here that the scope is one singleton per <i>injector</i>, not per <i>application</i>. If your
      application has multiple injectors, <i>each</i> of those injectors will hold a separate/distinct reference of the singleton object. Refer the section on Singleton scope
      <a href="#Ch5_SingletonScope">here for details</a>.
      <img src="imgs/ch5/Singleton_vs_Prototype_LifeCycle.png"
           class="center-block img-fluid"
           alt="Singleton_vs_Prototype_LifeCycle"
           width="300">
    </div>

    <div class="sub-heading">How to decide when to use a Singleton</div>
    <div>
      - If a service represents a conceptual nexus for clients, then it is a likely candidate. For instance, a database connection pool is a central port of call for any service
      that wants to connect to a database. Thus, connection pools are good candidates for singleton scoping. <br>
      - Services that are stateless (in other words, objects that have no dependencies or whose dependencies are immutable) are good candidates. <br>
      - In the scenario where there are no states to manage, either of prototype or singleton scopes can be used. Singleton does have some advantages over prototype in these
      scenarios: <br>
      a) Objects can be created at startup (sometimes called <i>eager instantiation</i>), saving on construction and wiring overhead. <br>
      b) There is a single point of reference when stepping through a debugger. <br>
      c) Maintaining the lone instance saves on memory (memory complexity is constant as opposed to linear in the case of no scoping) <br>
      - Remember the singleton litmus test: Should the object exist for the same duration as the injector?
    </div>

    <div class="sub-heading">Singletons in Practice: Keys are bound under scope, not object or class (Spring example)</div>
    <div>
      - The important thing to keep in mind about scoping is that a key is bound under a scope, not an object or class. This is true of any scope, not just the singleton. <br>
      - This is how we would create Singleton scoped beans in the case of Spring. Note that we can also use two different bean names for the same class. (Using
      <i>camera.basement</i> and <i>camera.penthouse</i> for the same class <i>SimpleCamera</i>).
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/25205647b1a065b5a3801352519fc2f4.js"></script>
        </div>
      </div>

      - And then we can make use of the beans as follows. <i>camera.basement</i> and <i>camera.penthouse</i> are declared as prototype, hence we get different instances of the
      <i>SimpleCamera</i> class that is associated with the beans. But the <i>MasterTerminal</i> class that is injected into the <i>SimpleCamera</i> class is declared as a
      Singleton, and hence the instance injected into the two classes is the same.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/4433f370c885b7bb18b5cf50f05b8d09.js"></script>
        </div>
      </div>

      - But now, what would happen if we defined the two beans, <i>camera.basement</i> and <i>camera.penthouse</i>, as singletons? Note that both beans are supposed to create
      instances of the <i>SAME</i> class, i.e. <i>SimpleCamera</i>. So would the calls to <i>getBean</i> return the <i>same</i> instance of the <i>SimpleClass</i>? <br>
      - We changed the xml so that the two beans are now defined as singletons.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/468c3d5debc04c87ba001303a69dd25b.js"></script>
        </div>
      </div>

      - And we are running the following test. As you can see, the instance of the <i>SimpleClass</i> that is returned from the injector are different. Despite the
      <i>SimpleClass</i> being associated with a <i>Singleton</i> key. What does this tell us? This tells us that in the case of an injector, the scope is a concept that is
      associated COMPLETELY with the key. Not with the class. Not with the object. But with a key. It is the <i>KEY</i> that is bound under a scope. If you ask the injector for an
      object via it's key, the injector will look at the key, see if it is a singleton or prototype, and based off of that, return either the same object, or a new object. There is
      nothing stopping you from having a completely different key for the same class. The injector does not care about the class. If a key is bound to Singleton, injector can allow
      multiple instances of the class. But it will allow only ONE instance associated with the key that will be shared with all the dependents.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/f9ba31db060d9a3ac566d780af41ceb7.js"></script>
        </div>
      </div>

      - In fact, the same class can also be bound to both Singleton and Prototype. Consider the following xml configuration.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/9a9b7a77f97d2052b5bcd62726d99139.js"></script>
        </div>
      </div>
      - And the test class becomes this:
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/0c1390a9a287ed150484ccdbfbc2194a.js"></script>
        </div>
      </div>
    </div>

    <div class="sub-heading">Singletons in Practice: Keys are bound under scope, not object or class (Guice example)</div>
    <div>
      - The same thing we can do in Guice as well. Consider the simple way first where we have the following Guice Module setup.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/3d89a7b62a1eac450a6d3e58bb60051a.js"></script>
        </div>
      </div>

      - And the classes making use of the module would look like this. <i>BasementCamera</i> and <i>PenthouseCamera</i> require instances of <i>Camera</i> that is declared as
      prototype in the Guice Module. Hence, everytime that we construct a new <i>BasementCamera</i> and <i>PenthouseCamera</i>, a new instance of <i>Camera</i> would be injected
      into it.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/4fa8094ce253075496cd394cbe82b231.js"></script>
        </div>
      </div>

      - When two instances of prototype key are being injected into the same constructor, they are still different instances. Consider the following case. <i>BasementFloor</i>
      requires two instances of the object bound to the <i>[Camera, Basement]</i> key. Both the instances will be different since the <i>[Camera, Basement]</i> key is bound to the
      prototype scope.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/c2dac3b6cf94b3eaffe02866ef038952.js"></script>
        </div>
      </div>

      - Similarly, in this case all four fields of <i>Building</i> receive different instances of <i>Camera</i> even though only two keys are present.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/5aae36e8f1a53dd73359412cd7dce351.js"></script>
        </div>
      </div>

      - This is opposed to the following class, <i>ControlRoom</i>, which has four fields that refer to the same instance of <i>MasterTerminal</i> but via four references.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/f718d614a35d01f932de1a25f48f635f.js"></script>
        </div>
      </div>

      - But now, (to recreate the example we saw in Spring above), let us consider the following Guice Module setup. We have two keys defined: <i>[MasterTerminal, RoofMaster]</i>
      and <i>[MasterTerminal, BasementMaster]</i>. Both of these keys will return an instance of <i>MasterTerminalImpl</i> when injected. Both of these keys are also defined as
      <code>Singleton</code>. This means that the object associated with <i>each</i> of <i>[MasterTerminal, RoofMaster]</i> and <i>[MasterTerminal, BasementMaster]</i> keys will be
      unique.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/cb539de68bce8af9caa00d7c16ad16c2.js"></script>
        </div>
      </div>

      - Now we make use of the keys in the following test. <i>[MasterTerminal, RoofMaster]</i> and <i>[MasterTerminal, BasementMaster]</i> keys are bound to the same class declared
      as Singleton. But the instances that are returned by either of the keys are different. Any dependents of <i>[MasterTerminal, RoofMaster]</i> see the SAME SHARED instance. But
      any dependents of <i>[MasterTerminal, BasementMaster]</i> see a DIFFERENT SHARED instance.
      <div class="code-block">
        <div class="expand-code-snip-btn border border-primary rounded">
          <span class="btn btn-link">Expand Gist <img src="imgs/chevron-expand.svg" alt="Expand Code Snippet"></span>
        </div>
        <div class="code-snippet">
          <script src="https://gist.github.com/rgbk21/ea0878f91b0dcb30b22c062d4ac1036c.js"></script>
        </div>
      </div>

      - To reiterate, it is very important to distinguish that a key, rather than an object, is bound under a scope. Singleton scoping allows many instances of the same class to
      exist and be used by dependents; it allows only one shared instance of a key. <br>
      - This is different from the conventional "Singleton Design Pattern" that we see being used in books which defines a more absolute singleton in the sense that there can
      always be exactly one instance of a class in an application. This is often considered as an anti-pattern.
    </div>


    <div class="sub-heading">The Singleton Anti-Pattern</div>
    <div>
      - As mentioned above, there is a difference between <i>singleton scope</i>, a feature of DI, and <i>singleton objects</i> (or singleton anti-patterns). <br>
      - Singleton objects are shared even between injectors and can cause a real headache if you are trying to separate modules by walling them off in their own injectors. <br>
      - Singleton objects bad, singleton scoping good. Singleton objects make testing difficult if not impossible and are antithetical to good design with dependency injection.
      Singleton scoping, on the other hand, is a purely injector-driven feature and completely removed from the class in question. <br>
      - Singleton scope is thus flexible and grants the usefulness of the Singleton antipattern without all of its nasty problems.
      <img src="imgs/ch5/SingletonAntiPattern.PNG"
           class="center-block img-fluid"
           alt="SingletonAntiPattern"
           width="750">
    </div>

    <div class="sub-heading">Domain-Specific Scopes - The Web</div>
    <div>
      - Goes over request-scoped objects and session-scoped objects. <br>
      - TODO.
    </div>
  </div>


  <hr>
  <div id="Prasanna_Chapter6" class="chapter">Chapter 6: More use cases in scoping</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">Defining a custom scope</div>
    <div>

    </div>

  </div>

  <hr>
  <div id="Pithawala_Chapter4" class="chapter">Chapter 4: Guice in Web Development</div>
  <hr>

  <div class="textual-content">
    <div class="sub-heading">Defining a custom scope</div>
    <div>

    </div>

  </div>

</div>


<script src="../../script.js"></script>
</body>
</html>
